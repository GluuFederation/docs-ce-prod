
<!DOCTYPE html>
<html class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documenation for Gluu Server">
      
      
      
      
        <link rel="shortcut icon" href="../../favicon.ico">
      
      <meta name="generator" content="mkdocs+mkdocs-material#1.0.3">
    
    
      
        <title>Custom Authentication - Gluu Docs</title>
      
    
    
      <script src="../../assets/javascripts/modernizr-facb31f4a3.js"></script>
    
    
      
        
        
        
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application-f3ab63f78a.css">
      
      
    
    
  </head>
  
  
  
  
    <body>
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
	 <div class="md-flex__cell md-flex__cell--shrink">
	    <a href="https://gluu.org/docs/" title="Gluu Docs" class=" md-logo  md-header-nav__button">
          
            <img src="../../gluu.jpg" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
                <span class="md-header-nav__parent">
                  Administration Guide
                </span>
              
                <span class="md-header-nav__parent">
                  User Authentication Guide
                </span>
              
            
            Custom Authentication
          
        </span>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
          
<div class="md-search" data-md-component="search">
  <div class="md-search__overlay"></div>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" accesskey="s" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false">
      <label class="md-icon md-search__icon" for="search"></label>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result"></div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            
              


  


  <a href="https://github.com/GluuFederation/docs-dev" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

            
          </div>
      </div>
    </div>
<!-- Second Nav Bar 
<nav class="md-secondary-header-nav md-grid" style="
    height: 58px;
    background: white;
	color: #555555;
	font-weight: bold;
	font-size; 8px
	overflow: hidden;
">
<div class="md-flex-secondary" style="
    display: table;
    padding: 10px;
">
<label for="Versions">Ver:<select id="versions" onchange="window.location.href=this.value;" style="
    position: relative;
    display: inline-block;
    min-width: 100%;
    /* width: 120%; */
    height: 34px;
    padding: 6px 30px 6px 15px;
    color: #555555;
    border: none;
    background: transparent;
    outline: none;
    -webkit-appearance: none;
    z-index: 99;
    cursor: pointer;
    font-size: 16px;
    margin-bottom: 10px;
    border: 1px;
">
  <option value="/docs">Latest</option>
  <option value="/docs/2.4.4">2.4.4</option>
    </select> 
</label>
 </div>
 </nav>-->
   </nav>
</header>
    
    <div class="md-container">
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary">

  <label class="md-nav__title md-nav__title--site" for="drawer">
    <i class=" md-logo  md-nav__button">
      
        <img src="../../gluu.jpg">
      
    </i>
    Gluu Docs
	<label for="Versions">Ver:
	  <select id="versions" onchange="window.location.href=this.value;" style="
		position: inherit;
		display: inline;
		min-width: 25%;
		/* width: 120%; */
		height: 22px;
		padding: 5px 15px 5px 5px;
		color: Black;
		border: none;
		background: transparent;
		outline: none;
		-webkit-appearance: none;
		z-index: 99;
		cursor: pointer;
		font-size: 10px;
		margin-bottom: 10px;
		border: 1px solid black;
		overflow: auto
	">
	  <option value="/docs/ce/3.0.2">3.0.2</option>
	  <option value="/docs/ce/3.0.1">3.0.1</option>
	  <option value="/docs/ce/2.4.4">2.4.4</option>
	  <option value="/docs">All Versions</option>
		</select> 
	</label>
  </label>
    
    <div class="md-nav__source">
      


  


  <a href="https://github.com/GluuFederation/docs-dev" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  <li class="md-nav__item">
    
      <a href="../.." title="Home" class="md-nav__link">
        Home
      </a>
    
  </li>

    
      
      
  <li class="md-nav__item">
    
      <a href="../../operation/intro/" title="Whats new in 3.x" class="md-nav__link">
        Whats new in 3.x
      </a>
    
  </li>

    
      
      
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Installation Guide
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-3">
        Installation Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item">
    
      <a href="../../installation-guide/" title="Preparing VM" class="md-nav__link">
        Preparing VM
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../installation-guide/install/" title="Install Gluu Server" class="md-nav__link">
        Install Gluu Server
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../installation-guide/setup_py/" title="Setup Script Options" class="md-nav__link">
        Setup Script Options
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-4" type="checkbox" id="nav-3-4">
    
    <label class="md-nav__link" for="nav-3-4">
      Upgrade/Patch Guide
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-3-4">
        Upgrade/Patch Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item">
    
      <a href="../../upgrade/" title="Upgrade Gluu Server" class="md-nav__link">
        Upgrade Gluu Server
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../upgrade/manual-update/" title="Upgrade Gluu Server with OpenDJ" class="md-nav__link">
        Upgrade Gluu Server with OpenDJ
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../upgrade/update-war/" title="Updating a War File" class="md-nav__link">
        Updating a War File
      </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      Administration Guide
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-4">
        Administration Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item">
    
      <a href="../../admin-guide/oxtrust-ui/" title="oxTrust admin UI" class="md-nav__link">
        oxTrust admin UI
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../admin-guide/custom-script/" title="Interception Scripts" class="md-nav__link">
        Interception Scripts
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-3" type="checkbox" id="nav-4-3" checked>
    
    <label class="md-nav__link" for="nav-4-3">
      User Authentication Guide
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-4-3">
        User Authentication Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item">
    
      <a href="../intro/" title="User Authentication Introduction" class="md-nav__link">
        User Authentication Introduction
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../basic/" title="Basic Authenticatoin" class="md-nav__link">
        Basic Authenticatoin
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../passport/" title="Social Authentication" class="md-nav__link">
        Social Authentication
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../supergluu/" title="Super Gluu" class="md-nav__link">
        Super Gluu
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../U2F/" title="FIDO U2F" class="md-nav__link">
        FIDO U2F
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../duo/" title="Duo Security" class="md-nav__link">
        Duo Security
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../cert-auth/" title="Certificate Authentication" class="md-nav__link">
        Certificate Authentication
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../google/" title="Google+ OAuth 2.0" class="md-nav__link">
        Google+ OAuth 2.0
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../otp/" title="HOTP/TOTP" class="md-nav__link">
        HOTP/TOTP
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Custom Authentication
      </label>
    
    <a href="./" title="Custom Authentication" class="md-nav__link md-nav__link--active">
      Custom Authentication
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" title="Overview" class="md-nav__link">
    Overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#suggested-development-environment" title="Suggested Development Environment" class="md-nav__link">
    Suggested Development Environment
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#custom-script-location" title="Custom Script Location" class="md-nav__link">
    Custom Script Location
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fields-in-custom-script" title="Fields in Custom Script:" class="md-nav__link">
    Fields in Custom Script:
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-initial-files" title="Create Initial Files" class="md-nav__link">
    Create Initial Files
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samples-and-documentation" title="Samples and Documentation" class="md-nav__link">
    Samples and Documentation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implement-methods-using-twilio-sms" title="Implement methods - Using Twilio SMS" class="md-nav__link">
    Implement methods - Using Twilio SMS
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#methods" title="Methods" class="md-nav__link">
    Methods
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#saving-and-passing-values" title="Saving and Passing Values" class="md-nav__link">
    Saving and Passing Values
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#saving-values" title="Saving Values:" class="md-nav__link">
    Saving Values:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#retriving-and-passing-values-between-steps" title="Retriving and passing values between steps" class="md-nav__link">
    Retriving and passing values between steps
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#custom-properties" title="Custom Properties" class="md-nav__link">
    Custom Properties
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#returning-a-message-to-the-user" title="Returning a message to the user" class="md-nav__link">
    Returning a message to the user
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adding-libraries" title="Adding Libraries" class="md-nav__link">
    Adding Libraries
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing" title="Testing" class="md-nav__link">
    Testing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reverting-authentication-method" title="Reverting Authentication Method" class="md-nav__link">
    Reverting Authentication Method
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../admin-guide/user-group/" title="User Management" class="md-nav__link">
        User Management
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../admin-guide/session/" title="Session Timeout" class="md-nav__link">
        Session Timeout
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../admin-guide/saml/" title="SAML" class="md-nav__link">
        SAML
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../admin-guide/openid-connect/" title="OpenID Connect" class="md-nav__link">
        OpenID Connect
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../admin-guide/uma/" title="UMA" class="md-nav__link">
        UMA
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../admin-guide/scim-uma/" title="SCIM protected by UMA" class="md-nav__link">
        SCIM protected by UMA
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../admin-guide/certificate/" title="Certificate Management" class="md-nav__link">
        Certificate Management
      </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Integration Guide
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-5">
        Integration Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item">
    
      <a href="../../integration/" title="Introduction" class="md-nav__link">
        Introduction
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-2" type="checkbox" id="nav-5-2">
    
    <label class="md-nav__link" for="nav-5-2">
      Mobile Apps
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-5-2">
        Mobile Apps
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item">
    
      <a href="../../integration/mobile/appauth-oauth2.0-android/" title="Android" class="md-nav__link">
        Android
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../integration/mobile/App-Auth-IOS/" title="iOS" class="md-nav__link">
        iOS
      </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-3" type="checkbox" id="nav-5-3">
    
    <label class="md-nav__link" for="nav-5-3">
      Single Page Apps
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-5-3">
        Single Page Apps
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item">
    
      <a href="../../integration/spa/angular/" title="Angular" class="md-nav__link">
        Angular
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../integration/spa/javascript/" title="JavaScript" class="md-nav__link">
        JavaScript
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../integration/spa/jquery/" title="jQuery" class="md-nav__link">
        jQuery
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../integration/spa/react/" title="React" class="md-nav__link">
        React
      </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-4" type="checkbox" id="nav-5-4">
    
    <label class="md-nav__link" for="nav-5-4">
      Web Apps
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-5-4">
        Web Apps
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item">
    
      <a href="../../integration/webapps/apache/" title="Apache" class="md-nav__link">
        Apache
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../integration/webapps/csharp/" title="C Sharp" class="md-nav__link">
        C Sharp
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../integration/webapps/go/" title="GO" class="md-nav__link">
        GO
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../integration/webapps/java/" title="Java" class="md-nav__link">
        Java
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../integration/webapps/play/" title="Java Play" class="md-nav__link">
        Java Play
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../integration/webapps/springmvc/" title="Java Spring MVC" class="md-nav__link">
        Java Spring MVC
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../integration/webapps/springsecurity/" title="Java Spring Security" class="md-nav__link">
        Java Spring Security
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../integration/webapps/net/" title=".NET" class="md-nav__link">
        .NET
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../integration/webapps/node/" title="Node" class="md-nav__link">
        Node
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../integration/webapps/nginx/" title="Nginx" class="md-nav__link">
        Nginx
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../integration/webapps/perl/" title="Perl" class="md-nav__link">
        Perl
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../integration/webapps/python/" title="Python" class="md-nav__link">
        Python
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../integration/webapps/flask/" title="Python Flask" class="md-nav__link">
        Python Flask
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../integration/webapps/ruby/" title="Ruby" class="md-nav__link">
        Ruby
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../integration/webapps/rails/" title="Ruby On Rails" class="md-nav__link">
        Ruby On Rails
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../integration/saml-sp/" title="Shibboleth SP" class="md-nav__link">
        Shibboleth SP
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../integration/openidc-rp/" title="mod_auth_openidc" class="md-nav__link">
        mod_auth_openidc
      </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-5" type="checkbox" id="nav-5-5">
    
    <label class="md-nav__link" for="nav-5-5">
      Backend APIs
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-5-5">
        Backend APIs
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item">
    
      <a href="../../integration/api/intro/" title="api" class="md-nav__link">
        api
      </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-6" type="checkbox" id="nav-5-6">
    
    <label class="md-nav__link" for="nav-5-6">
      Off-the-Shelf Apps
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-5-6">
        Off-the-Shelf Apps
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-6-1" type="checkbox" id="nav-5-6-1">
    
    <label class="md-nav__link" for="nav-5-6-1">
      SaaS
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-5-6-1">
        SaaS
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item">
    
      <a href="../../integration/saas/google/" title="Google SSO" class="md-nav__link">
        Google SSO
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../integration/saas/office/" title="Office 365" class="md-nav__link">
        Office 365
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../integration/saas/salesforce/" title="Salesforce" class="md-nav__link">
        Salesforce
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../integration/saas/dropbox/" title="Dropbox" class="md-nav__link">
        Dropbox
      </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-6-2" type="checkbox" id="nav-5-6-2">
    
    <label class="md-nav__link" for="nav-5-6-2">
      FOSS
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-5-6-2">
        FOSS
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item">
    
      <a href="../../integration/foss/drupal/" title="Drupal" class="md-nav__link">
        Drupal
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../integration/foss/magento/" title="Magento" class="md-nav__link">
        Magento
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../integration/foss/nextcloud/" title="NextCloud" class="md-nav__link">
        NextCloud
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../integration/foss/opencart/" title="OpenCart" class="md-nav__link">
        OpenCart
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../integration/foss/roundcube/" title="RoundCube" class="md-nav__link">
        RoundCube
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../integration/foss/sugarcrm/" title="SugarCRM" class="md-nav__link">
        SugarCRM
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../integration/foss/suitecrm/" title="SuiteCRM" class="md-nav__link">
        SuiteCRM
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../integration/foss/shopify/" title="Shopify" class="md-nav__link">
        Shopify
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../integration/foss/wordpress/" title="Wordpress" class="md-nav__link">
        Wordpress
      </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Reference
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-6">
        Reference
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-1" type="checkbox" id="nav-6-1">
    
    <label class="md-nav__link" for="nav-6-1">
      Gluu API Guide
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-6-1">
        Gluu API Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item">
    
      <a href="../../api-guide/api/" title="Custom ID Generation" class="md-nav__link">
        Custom ID Generation
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../api-guide/openid-connect-api/" title="OpenID Connect API" class="md-nav__link">
        OpenID Connect API
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../api-guide/scim-api/" title="SCIM API Configuration" class="md-nav__link">
        SCIM API Configuration
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../api-guide/uma-api/" title="UMA API" class="md-nav__link">
        UMA API
      </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-2" type="checkbox" id="nav-6-2">
    
    <label class="md-nav__link" for="nav-6-2">
      JSON Properties
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-6-2">
        JSON Properties
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item">
    
      <a href="../../reference/JSON-oxtrust-prop/" title="OxTrust JSON Properties" class="md-nav__link">
        OxTrust JSON Properties
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../reference/JSON-oxauth-prop/" title="OxAuth JSON Properties" class="md-nav__link">
        OxAuth JSON Properties
      </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-3" type="checkbox" id="nav-6-3">
    
    <label class="md-nav__link" for="nav-6-3">
      Gluu LDAP Schema
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-6-3">
        Gluu LDAP Schema
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item">
    
      <a href="../../reference/oxldap/" title="Ox LDAP Properties" class="md-nav__link">
        Ox LDAP Properties
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../reference/schema/" title="OpenLDAP Schema" class="md-nav__link">
        OpenLDAP Schema
      </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Operation Guide
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-7">
        Operation Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item">
    
      <a href="../../operation/backup/" title="Backups" class="md-nav__link">
        Backups
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../operation/find-gluu-version/" title="Find your Gluu Version" class="md-nav__link">
        Find your Gluu Version
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../operation/ports/" title="Ports" class="md-nav__link">
        Ports
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../operation/logout/" title="Single Logout (SLO)" class="md-nav__link">
        Single Logout (SLO)
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../operation/logs/" title="Log Management" class="md-nav__link">
        Log Management
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../operation/faq/" title="FAQ & Troubleshooting" class="md-nav__link">
        FAQ & Troubleshooting
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../operation/custom-loginpage/" title="Customize Login Page" class="md-nav__link">
        Customize Login Page
      </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Developer Guide
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-8">
        Developer Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item">
    
      <a href="../../developer-guide/oxtrust-eclipse/" title="Build OxTrust with Eclipse" class="md-nav__link">
        Build OxTrust with Eclipse
      </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" title="Overview" class="md-nav__link">
    Overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#suggested-development-environment" title="Suggested Development Environment" class="md-nav__link">
    Suggested Development Environment
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#custom-script-location" title="Custom Script Location" class="md-nav__link">
    Custom Script Location
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fields-in-custom-script" title="Fields in Custom Script:" class="md-nav__link">
    Fields in Custom Script:
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-initial-files" title="Create Initial Files" class="md-nav__link">
    Create Initial Files
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samples-and-documentation" title="Samples and Documentation" class="md-nav__link">
    Samples and Documentation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implement-methods-using-twilio-sms" title="Implement methods - Using Twilio SMS" class="md-nav__link">
    Implement methods - Using Twilio SMS
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#methods" title="Methods" class="md-nav__link">
    Methods
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#saving-and-passing-values" title="Saving and Passing Values" class="md-nav__link">
    Saving and Passing Values
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#saving-values" title="Saving Values:" class="md-nav__link">
    Saving Values:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#retriving-and-passing-values-between-steps" title="Retriving and passing values between steps" class="md-nav__link">
    Retriving and passing values between steps
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#custom-properties" title="Custom Properties" class="md-nav__link">
    Custom Properties
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#returning-a-message-to-the-user" title="Returning a message to the user" class="md-nav__link">
    Returning a message to the user
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adding-libraries" title="Adding Libraries" class="md-nav__link">
    Adding Libraries
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing" title="Testing" class="md-nav__link">
    Testing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reverting-authentication-method" title="Reverting Authentication Method" class="md-nav__link">
    Reverting Authentication Method
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
               
                 <a href="https://github.com/GluuFederation/docs-dev/blob/master/source/authn-guide\customauthn.md" title="Edit this page" class="md-icon md-content__edit">edit</a>
               
              
                
                <h1 id="custom-authentication-script-tutorial">Custom Authentication Script Tutorial<a class="headerlink" href="#custom-authentication-script-tutorial" title="Permanent link">#</a></h1>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">#</a></h2>
<p><a href="../../admin-guide/custom-script/">Interception scripts</a> enable you to customize your Gluu authentication service. In an interception script you can call external APIs, like a commercial authentication service, a DDoS protection service, a fraud detection service, etc., to make your authentication process more secure. In addition, interception scripts give you the ability to implement business driven policies during authentication. </p>
<p>For example, you may want to only prompt users in a certain group for two-factor authentication. Or, you may want to only prompt a user for two-factor authentication if the request is coming from an unknown IP address. These types of policies can be incorporated into your authentication service by writing an interception script that uses the <a href="#methods">methods</a> described below.</p>
<p>This tutorial explains how to write a script to implement a two-step out-of-band authentication using Twilio to send an SMS with a one-time password. At the end of this tutorial you should have a better understanding of how to write your own custom scripts. For reference, you can review the completed Twilio custom authentication script <a href="https://raw.githubusercontent.com/GluuFederation/oxAuth/master/Server/integrations/twilio_sms/twilio2FA.py">here</a>. </p>
<h2 id="suggested-development-environment">Suggested Development Environment<a class="headerlink" href="#suggested-development-environment" title="Permanent link">#</a></h2>
<p>Gluu Server custom scripts are written in <a href="http://www.jython.org/">Jython</a>. We recommended using Eclipse for coding purposes.</p>
<h2 id="custom-script-location">Custom Script Location<a class="headerlink" href="#custom-script-location" title="Permanent link">#</a></h2>
<p>The GUI for custom authentication scripts can be found by navigating to </p>
<p><code>Configuration</code> &gt; <code>Manage Custom Scripts</code> &gt; <code>Person Authentication</code>. </p>
<p>Custom scripts can either be inserted directly into the GUI or you can 
specify a path to the script. We recommend specifying a path in order to 
make development easier. To specify a path, select <code>File</code> from the <code>Script Location Type</code> field in oxTrust and the <code>Script Path</code> input box will be displayed:</p>
<p><img alt="image" src="../../img/admin-guide/multi-factor/script_upload_box.png" /></p>
<p>The <code>LDAP</code> option in the <code>Script Location Type</code> can be used to store the script in the LDAP tree once development is complete. Remember that selecting the <code>LDAP</code> method requires the script to be copied in the input box that appears upon LDAP selection:</p>
<p><img alt="image" src="../../img/admin-guide/multi-factor/script_in_ldap.png" /></p>
<h2 id="fields-in-custom-script">Fields in Custom Script:<a class="headerlink" href="#fields-in-custom-script" title="Permanent link">#</a></h2>
<table>
<thead>
<tr>
<th>Field</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Name</td>
<td align="left">Name of the Script</td>
</tr>
<tr>
<td>Description</td>
<td align="left">[optional] Description of the script</td>
</tr>
<tr>
<td>Programming Language</td>
<td align="left">Currently Python is supported, in the future jscript and Java will be added</td>
</tr>
<tr>
<td>Level</td>
<td align="left">Authentication Level for the authentication, which determines the security level</td>
</tr>
<tr>
<td>Location Type</td>
<td align="left">The script can be stored in a "File" or in "LDAP"</td>
</tr>
<tr>
<td>Usage Type</td>
<td align="left">The script can be written for Web, Native or Both types of applications</td>
</tr>
<tr>
<td>Custome Property</td>
<td align="left">Determines the key and value of the custom property, which can be added to the authentication to pass values between steps</td>
</tr>
<tr>
<td>Script Box</td>
<td align="left">Script Box will displayed if Location Type is selected as "File", to enter the path of the script</td>
</tr>
<tr>
<td>Script</td>
<td align="left">Script Box will be displayed when Location Type is selected as "LDAP"</td>
</tr>
</tbody>
</table>
<h2 id="create-initial-files">Create Initial Files<a class="headerlink" href="#create-initial-files" title="Permanent link">#</a></h2>
<p>Create the following files:</p>
<ul>
<li>A Python file for your script;</li>
<li>One or more XHTML files if you have a custom form for your authentication;</li>
<li>One or more XML files (you'll need one for each XHTML file) that provide information to the Tomcat server about how to display the XHTML file.</li>
</ul>
<h2 id="samples-and-documentation">Samples and Documentation<a class="headerlink" href="#samples-and-documentation" title="Permanent link">#</a></h2>
<p>There are many good examples of authentication interception scripts in Gluu's <a href="https://github.com/GluuFederation/oxAuth/tree/master/Server/integrations">oxAuth integrations folder</a>. The respective <code>XHTML</code> and <code>XML</code> files are checked into the <a href="https://github.com/GluuFederation/oxAuth/tree/master/Server/src/main/webapp/auth">auth folder</a>. The interfaces for authentication interception scripts can be found in the <a href="http://www.gluu.org/docs/reference/interception-scripts/#authentication">Gluu Documentation</a>.</p>
<p>We used the <a href="https://raw.githubusercontent.com/GluuFederation/oxAuth/master/Server/integrations/basic/BasicExternalAuthenticator.py">Basic Script</a> 
as a template. The <a href="https://github.com/GluuFederation/oxAuth/tree/master/Server/src/main/webapp/auth/wikid">Wikid forms</a> 
were also used as a template since it requires that we pass the value of the <code>code</code> obtained from Twilio to step 2 of the authentication to validate and authenticate the user.</p>
<p>The <a href="https://github.com/GluuFederation/oxAuth/blob/master/Server/integrations/wikid/WikidExternalAuthenticator.py">Wikid authentication</a> script was also looked upon for examples on how to process the form.</p>
<h2 id="implement-methods-using-twilio-sms">Implement methods - Using Twilio SMS<a class="headerlink" href="#implement-methods-using-twilio-sms" title="Permanent link">#</a></h2>
<p>Steps to add a custom template and pass values between 2 steps of authentication for our sample 
<a href="https://raw.githubusercontent.com/GluuFederation/oxAuth/master/Server/integrations/twilio_sms/twilio2FA.py">Twilio script</a>:</p>
<ol>
<li>Login to Gluu UI;</li>
<li>Navigate to <code>Configuration</code> &gt; <code>Manage Custom Scripts</code>;</li>
<li>Scroll to the end of the page and click <code>Add custom script configuration</code>;</li>
<li>Enter the Name, Description, and Programming Language (Python will be by default);</li>
<li>Select the Level to set a security level;</li>
<li>Select Location Type for the script;</li>
<li>Select the Usage Type for the authentication;</li>
<li>Define Custom property, which in our example is provided by Twilio;</li>
<li>Click on Enabled to enable the script;</li>
<li>Scroll down to the bottom of the form and click <code>submit</code>;</li>
<li>After the custom script is added, navigate to <code>Configuration</code> &gt; <code>Manage Authenticaion</code> &gt; <code>Default Authentication Method</code> and change the oxTrust authentication mode to "Twilio" (or the custom name of your script). </li>
</ol>
<p><strong>Note: All three below custom properties are mandatory for the Twilio Two-Factor Authentication script to work</strong>     </p>
<ul>
<li>ACCOUNT_SID - Numerical sequence of numbers, to identify the token assigned to the user associated with Twilio.      </li>
<li>AUTH TOKEN  - Alphanumerical number provided by Twilio for the account holder to identify the user.      </li>
<li>FROM_NUMBER - Number which is either assigned by Twilio or can be a number user provides to send the code from.       </li>
</ul>
<p>As shown in the below illustration:</p>
<p><img alt="image" src="../../img/admin-guide/multi-factor/twilio.png" /></p>
<h2 id="methods">Methods<a class="headerlink" href="#methods" title="Permanent link">#</a></h2>
<p><strong>authenticate():</strong>    <br />
The most important method to implement is the <code>authenticate</code> method. This is where the main business logic is located for
the authentication workflow. It is possible to switch on the step, with the <code>if (step == 1):</code> statement. In oxAuth, there is no
assumption that step 1 and step 2 happen on the same server, therefore the value is stored in LDAP using a temporarily created attribute that can be retrieved in step 2. The step is sent to the <code>authenticate</code> method, which helps to save and retrieve the values as required.</p>
<p>Below are a few Methods and Libraries used to Save the Value to LDAP and retrieve the values as required:</p>
<p><strong>random.randit()</strong>   <br />
<code>random.randit("start number",""end number")</code> Generates the code as required.     </p>
<p>Example: <code>random.randit(10000,99999)</code></p>
<p><strong>context.set()</strong>   <br />
This particular method is obtained from jboss to pass the session attribute value to LDAP by creating a temporary attribute which has a limited lifetime and can be retrieved within the life span, otherwise it expires and the session becomes invalid. Save the value of the code obtained through the code generator method. <code>context.set("Name of the temp attribute", &lt;key&gt;)</code> where <code>&lt;key&gt;</code> is the value that needs to be stored temporarily in ldap.</p>
<p>Example: <code>context.set("code",code)</code>       </p>
<p><strong>UserService.instance()</strong>          <br />
Gets the user login instance      </p>
<p><strong>ServerUtil.getFirstValue():</strong>         <br />
To access  information from <code>requestParameters</code> in your script with <code>ServerUtil.getFirstValue(requestParameters, &lt;key&gt;)</code> where <code>&lt;key&gt;</code>
specifies the value you want to retrieve, you can also use another method <code>requestParameters.get("&lt;key&gt;")</code>
where <code>&lt;key&gt;</code> specifies the value you want to retrieve .     </p>
<p><strong>userService.getUserByAttribute():</strong>   <br />
<code>getUserByAttribute("LDAP Attribute", &lt;key&gt;)</code> method accesses information in LDAP and retrieves the value of the attribute comparing the value of the <code>&lt;Key&gt;</code>.      </p>
<p>Example: <code>userService.getUserByAttribute("uid", user_name)</code>       </p>
<p><strong>getAttribute():</strong>    <br />
To retrieve the value of an attribute from LDAP, <code>getAttribute("LDAP Attribute name")</code> can be used. </p>
<p>Example: <code>getAttribute("mobile")</code>     </p>
<p><strong>requestParameters.get():</strong>      <br />
<code>requestParameters.get(&lt;key&gt;)</code> can be used to retrieve values passed from the form through the headers. This will retrieve the values from the form via header and can be stored in a string. Where <code>&lt;key&gt;</code> is the value to be retrieved from header.</p>
<p>Example: <code>abc = requestParameters.get("passcode")[0].strip()</code>        </p>
<p><strong>getCountAuthenticationSteps():</strong>       <br />
Another method usually needed to implement is <code>getCountAuthenticationSteps</code>. This method normally just returns 1, 2, or 3. If implementing an adaptive authentication strategy, where the number of steps depends on the context. </p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Check the <a href="https://raw.githubusercontent.com/GluuFederation/oxAuth/master/Server/integrations/duo/DuoExternalAuthenticator.py">Duo script</a> 
for a good example of how <code>getCountAuthenticationSteps</code> can be used to implement adaptive authentication. The Duo script is scripted so that two-factor authentication is only presented for users in the IT group. The script checks for group membership and dynamically adjusts the number of steps. This can be implemented to check for any logic or attribute during the authentication, like "country" or "region".</p>
</div>
<p><strong>getExtraParametersForStep():</strong>   <br />
If required to save session variables between steps, use the <code>getExtraParametersForStep</code> method. The Gluu Server persists
these variables in LDAP in able to support stateless, clustered two-step authentications.      </p>
<p><strong>getPageForStep():</strong>     <br />
If required to display a special Web page for an interactive login, or even a custom first page, you'll need to implement the
<code>getPageForStep</code> method to specify the page you want to return for a given step.       </p>
<p><strong>session_attributes.get():</strong>      <br />
The attribute value that are saved by the session using <code>context.set</code>. This method is derived from the oxauth core java libraries and called using the <code>SessionState</code> parameters which is defined in the code or program as <code>session_attributes.get(&lt;key&gt;)</code>, where <code>&lt;key&gt;</code> is the session atribute value that is stored in the ldap.     </p>
<p>Example: <code>session_attributes.get("code")</code>        </p>
<h2 id="saving-and-passing-values">Saving and Passing Values<a class="headerlink" href="#saving-and-passing-values" title="Permanent link">#</a></h2>
<h3 id="saving-values">Saving Values:<a class="headerlink" href="#saving-values" title="Permanent link">#</a></h3>
<p><strong>context.set</strong> can be used to save values of the required key to an attribute temporarily and the created temporary attribute will be alive only for limited time and expires and gets removed, by that way, adding new attribute to the user is not messed up. And also the expired attribute kills the validity of the session and becomes invalid.       </p>
<h3 id="retriving-and-passing-values-between-steps">Retriving and passing values between steps<a class="headerlink" href="#retriving-and-passing-values-between-steps" title="Permanent link">#</a></h3>
<p>Using <strong>session_attribute.get()</strong> method, stored session attribute can be retrieved anywhere between the authentication method, enabling values to be passed between multiple authentication methods for verification and validation. Generated code and the entered "code" in the form can be verified using a simple if and the "code" from the form can be obtained using the <code>requestParameters.get()</code> method or <code>serviceUtil.getFirstValue()</code> method.</p>
<h2 id="custom-properties">Custom Properties<a class="headerlink" href="#custom-properties" title="Permanent link">#</a></h2>
<p>Sometimes it is helpful to enable system administrators to enter properties that might frequently change. If administrators are not allowed to modify the script, the Custom Property feature can be used as illustrated in below screenshot:</p>
<p><img alt="image" src="../../img/admin-guide/multi-factor/07-custom-properties.jpg" /></p>
<p><code>configurationAttributes.get("&lt;key&gt;").getValue2"()</code>:</p>
<p>To access this information in your script with <code>configurationAttributes.get("&lt;key&gt;").getValue2()</code> where <code>&lt;key&gt;</code> specifies the value you want to retrieve.</p>
<h2 id="returning-a-message-to-the-user">Returning a message to the user<a class="headerlink" href="#returning-a-message-to-the-user" title="Permanent link">#</a></h2>
<p>It is possible to use the Context to return a message to the user, which could be especially useful if an error occurs or some kind of user action is required.</p>
<h2 id="adding-libraries">Adding Libraries<a class="headerlink" href="#adding-libraries" title="Permanent link">#</a></h2>
<p>Pure Python libraries can be added to <code>/opt/gluu/python/libs</code>, and jar files can be added to  <code>/opt/gluu/jetty/oxauth/lib/ext</code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>jar files should be added within chroot. </p>
</div>
<h2 id="testing">Testing<a class="headerlink" href="#testing" title="Permanent link">#</a></h2>
<p>When the scripting is done, you can test the script by printing the statments to <code>oxtrust.log</code> under <code>/opt/gluu/jetty/identity/logs/oxtrust.log</code>. </p>
<p>Prefixing the logs will help to find the script using tail command <code>tail -f | grep &lt;prefix&gt;</code>, the prefix logs will provide the script output while one trys to login using the script.</p>
<p>In the Twilio test script, a specific method called <code>printOut</code> has been scripted to make it easier to add this prefix.</p>
<p>Also, remember that putting all the code in a <code>try / catch</code> is a good practice to avoid unhandled exceptions, since during debugging exceptions may provide a hint at what's causing the issue.</p>
<p>Further logs to debug and monitor the sequence can be done using <code>oxauth_script.log</code> and <code>oxauth.log</code> under <code>/opt/gluu/jetty/identity/logs/</code> which is within the chroot.</p>
<h2 id="reverting-authentication-method">Reverting Authentication Method<a class="headerlink" href="#reverting-authentication-method" title="Permanent link">#</a></h2>
<p>It is not uncommon to get locked out of the Gluu Server while testing the authentication script.</p>
<p>In such a case the following method can be used to revert back to the older authentication method:</p>
<ol>
<li>Open LDAP in a LDAP Browser (jxlorer is used here and recommended).</li>
<li>Navigate to "gluu &gt; appliances &gt; {GUID or applicance number}". <img alt="Revert authentication" src="../../img/integration/revert-authentication1.png" /></li>
<li>Search for "oxAuthenticationMode"  and "oxTrustAuthenticationMode" attribute and delete the values. <img alt="Revert authentication attrb" src="../../img/integration/revert-authentication2.png" /><ul>
<li>OxAuthenticationMode attribute is used for Login pages, which stores the name of the custom script used.</li>
<li>OxTrustAuthenticationMode is used for OxTrsut Admin UI page.</li>
</ul>
</li>
<li>Submit the changes.</li>
<li>Try to access the login page or Gluu Admin UI.
As a secondary option, InPrivate or Incognito or Private Browser from various Browsers can be used.</li>
</ol>
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../otp/" title="HOTP/TOTP" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                HOTP/TOTP
              </span>
            </div>
          </a>
        
        
          <a href="../../admin-guide/user-group/" title="User Management" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                User Management
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2017, Gluu, Inc.
          </div>
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application-2afe21e0b2.js"></script>
      <script>var config={url:{base:"../.."}},app=new Application(config);app.initialize()</script>
      
    
    
      
    
  </body>
</html>