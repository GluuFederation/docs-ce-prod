
<!DOCTYPE html>
<html class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documenation for Gluu Server">
      
      
      
      
        <link rel="shortcut icon" href="../favicon.ico">
      
      <meta name="generator" content="mkdocs+mkdocs-material#1.0.3">
    
    
      
        <title>Clustering with CE - Gluu Docs</title>
      
    
    
      <script src="../assets/javascripts/modernizr-facb31f4a3.js"></script>
    
    
      
        
        
        
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application-f3ab63f78a.css">
      
      
    
    
  </head>
  
  
  
  
    <body>
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
	 <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://gluu.org/docs/" title="Gluu Docs" class=" md-logo  md-header-nav__button">
          
            <img src="../gluu.jpg" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
                <span class="md-header-nav__parent">
                  Installation Guide
                </span>
              
                <span class="md-header-nav__parent">
                  Cluster Configuration
                </span>
              
            
            Clustering with CE
          
        </span>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
          
<div class="md-search" data-md-component="search">
  <div class="md-search__overlay"></div>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" accesskey="s" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false">
      <label class="md-icon md-search__icon" for="search"></label>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result"></div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            
              


  


  <a href="https://github.com/GluuFederation/docs-ce-prod/tree/2.4.4/2.4.4" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

            
          </div>
      </div>
    </div>
</nav>
</header>
    
    <div class="md-container">
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <i class=" md-logo  md-nav__button">
      
        <img src="../gluu.jpg">
      
    </i>
    Gluu Docs	
	<label for="Versions">Ver:
	  <select id="versions" onchange="window.location.href=this.value;" style="
		position: inherit;
		display: inline;
		min-width: 25%;
		/* width: 120%; */
		height: 22px;
		padding: 5px 15px 5px 5px;
		color: Black;
		border: none;
		background: transparent;
		outline: none;
		-webkit-appearance: none;
		z-index: 99;
		cursor: pointer;
		font-size: 10px;
		margin-bottom: 10px;
		border: 1px solid black;
		overflow: auto
	">
	  <option value="/docs/ce/2.4.4">2.4.4</option>
	  <option value="/docs/ce/latest">3.0.1</option>
	  <!--<option value="/docs/ce/3.0.0">3.0.0</option> -->
	  <option value="/docs">All Versions</option>
		</select> 
	</label>
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/GluuFederation/docs-ce-prod/tree/2.4.4/2.4.4" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  <li class="md-nav__item">
    
      <a href=".." title="Home" class="md-nav__link">
        Home
      </a>
    
  </li>

    
      
      
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Gluu Introduction
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-2">
        Gluu Introduction
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item">
    
      <a href="../introduction/history/" title="Histroy" class="md-nav__link">
        Histroy
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../introduction/design/" title="Design Goals" class="md-nav__link">
        Design Goals
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../introduction/architecture/" title="Gluu Server Architecture" class="md-nav__link">
        Gluu Server Architecture
      </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      Installation Guide
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-3">
        Installation Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item">
    
      <a href="../installation-guide/" title="Preparing VM" class="md-nav__link">
        Preparing VM
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../installation-guide/install/" title="Install Gluu Server" class="md-nav__link">
        Install Gluu Server
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../installation-guide/setup_py/" title="Setup Script Options" class="md-nav__link">
        Setup Script Options
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-4" type="checkbox" id="nav-3-4">
    
    <label class="md-nav__link" for="nav-3-4">
      Upgrade/Patch Guide
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-3-4">
        Upgrade/Patch Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item">
    
      <a href="../upgrade/upgrading/" title="Upgrade Gluu Server" class="md-nav__link">
        Upgrade Gluu Server
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../upgrade/updating/" title="Updating Gluu Server" class="md-nav__link">
        Updating Gluu Server
      </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-5" type="checkbox" id="nav-3-5" checked>
    
    <label class="md-nav__link" for="nav-3-5">
      Cluster Configuration
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-3-5">
        Cluster Configuration
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item">
    
      <a href="csync-installation/" title="Requirements: csync2 Installation" class="md-nav__link">
        Requirements: csync2 Installation
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Clustering with CE
      </label>
    
    <a href="./" title="Clustering with CE" class="md-nav__link md-nav__link--active">
      Clustering with CE
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#design" title="Design" class="md-nav__link">
    Design
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#requirements" title="Requirements" class="md-nav__link">
    Requirements
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#timezone-requirements" title="Timezone Requirements" class="md-nav__link">
    Timezone Requirements
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preparing-vms" title="Preparing VMs" class="md-nav__link">
    Preparing VMs
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#preparing-node-1-of-cluster" title="Preparing Node-1 of cluster:" class="md-nav__link">
    Preparing Node-1 of cluster:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#preparing-node-2-of-cluster" title="Preparing Node-2 of cluster:" class="md-nav__link">
    Preparing Node-2 of cluster:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ldap-replication" title="LDAP Replication" class="md-nav__link">
    LDAP Replication
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#file-system-replication" title="File System Replication" class="md-nav__link">
    File System Replication
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#csync2-installation" title="Csync2 installation" class="md-nav__link">
    Csync2 installation
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#csync2-configuration-for-host-1" title="Csync2 configuration for host-1" class="md-nav__link">
    Csync2 configuration for host-1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#csync2-configuration-for-host-2" title="Csync2 configuration for host-2" class="md-nav__link">
    Csync2 configuration for host-2
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#certificate-management" title="Certificate Management" class="md-nav__link">
    Certificate Management
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#optional-actions-in-case-setuppropertieslast-method-of-installation-didnt-work-for-you" title="[Optional] Actions in case setup.properties.last method of installation didn't work for you" class="md-nav__link">
    [Optional] Actions in case setup.properties.last method of installation didn't work for you
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Administration Guide
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-4">
        Administration Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item">
    
      <a href="../admin-guide/oxtrust-ui/" title="oxTrust admin UI" class="md-nav__link">
        oxTrust admin UI
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../admin-guide/custom-script/" title="Interception Scripts" class="md-nav__link">
        Interception Scripts
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-3" type="checkbox" id="nav-4-3">
    
    <label class="md-nav__link" for="nav-4-3">
      User Authentication Guide
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-4-3">
        User Authentication Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item">
    
      <a href="../admin-guide/user-authentications/" title="User Authentication Introduction" class="md-nav__link">
        User Authentication Introduction
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../authn-guide/passport/" title="Social Authentication" class="md-nav__link">
        Social Authentication
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../authn-guide/supergluu/" title="Super Gluu" class="md-nav__link">
        Super Gluu
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../authn-guide/U2F/" title="FIDO U2F" class="md-nav__link">
        FIDO U2F
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../authn-guide/duo/" title="Duo Security" class="md-nav__link">
        Duo Security
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../authn-guide/cert-auth/" title="Certificate Authentication" class="md-nav__link">
        Certificate Authentication
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../authn-guide/google/" title="Google" class="md-nav__link">
        Google
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../authn-guide/otp/" title="HOTP/TOTP" class="md-nav__link">
        HOTP/TOTP
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../authn-guide/customauthn/" title="Custom Authentication" class="md-nav__link">
        Custom Authentication
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../admin-guide/attributes/" title="Custom Attributes" class="md-nav__link">
        Custom Attributes
      </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../admin-guide/user-group/" title="User Management" class="md-nav__link">
        User Management
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../admin-guide/config/" title="Session timeout Configuration" class="md-nav__link">
        Session timeout Configuration
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../admin-guide/saml/" title="SAML" class="md-nav__link">
        SAML
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../admin-guide/oauth2/" title="OAuth2 Grants" class="md-nav__link">
        OAuth2 Grants
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../admin-guide/openid-connect/" title="OpenID Connect" class="md-nav__link">
        OpenID Connect
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../admin-guide/uma/" title="UMA" class="md-nav__link">
        UMA
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../admin-guide/scim-uma/" title="SCIM protected by UMA" class="md-nav__link">
        SCIM protected by UMA
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../admin-guide/certificates/" title="Certificate Management" class="md-nav__link">
        Certificate Management
      </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Integration Guide
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-5">
        Integration Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-1" type="checkbox" id="nav-5-1">
    
    <label class="md-nav__link" for="nav-5-1">
      Developer Guide
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-5-1">
        Developer Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item">
    
      <a href="../integration/oauth2/" title="oxd OAuth2" class="md-nav__link">
        oxd OAuth2
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../integration/oauth-js-implicit/" title="OAuth2.0 js Implicit Flow" class="md-nav__link">
        OAuth2.0 js Implicit Flow
      </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-2" type="checkbox" id="nav-5-2">
    
    <label class="md-nav__link" for="nav-5-2">
      Web Server Integrations
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-5-2">
        Web Server Integrations
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item">
    
      <a href="../integration/saml-sp/" title="Shibboleth SP" class="md-nav__link">
        Shibboleth SP
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../integration/openidc-rp/" title="mod_auth_openidc" class="md-nav__link">
        mod_auth_openidc
      </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-3" type="checkbox" id="nav-5-3">
    
    <label class="md-nav__link" for="nav-5-3">
      SaaS Integrations
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-5-3">
        SaaS Integrations
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item">
    
      <a href="../integration/google/" title="Google SSO" class="md-nav__link">
        Google SSO
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../integration/office/" title="Office 365" class="md-nav__link">
        Office 365
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../integration/hobsons/" title="Hobsons Education Sol" class="md-nav__link">
        Hobsons Education Sol
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../integration/salesforce/" title="Salesforce" class="md-nav__link">
        Salesforce
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../integration/dropbox/" title="Dropbox" class="md-nav__link">
        Dropbox
      </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Reference
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-6">
        Reference
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-1" type="checkbox" id="nav-6-1">
    
    <label class="md-nav__link" for="nav-6-1">
      Gluu API Guide
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-6-1">
        Gluu API Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item">
    
      <a href="../api-guide/api/" title="Custom ID Generation" class="md-nav__link">
        Custom ID Generation
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../api-guide/openid-connect-api/" title="OpenID Connect API" class="md-nav__link">
        OpenID Connect API
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../api-guide/scim-api/" title="SCIM API Configuration" class="md-nav__link">
        SCIM API Configuration
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../api-guide/uma-api/" title="UMA API" class="md-nav__link">
        UMA API
      </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-2" type="checkbox" id="nav-6-2">
    
    <label class="md-nav__link" for="nav-6-2">
      JSON Properties
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-6-2">
        JSON Properties
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item">
    
      <a href="../reference/JSON-oxtrust-prop/" title="OxTrust JSON Properties" class="md-nav__link">
        OxTrust JSON Properties
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../reference/JSON-oxauth-prop/" title="OxAuth JSON Properties" class="md-nav__link">
        OxAuth JSON Properties
      </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-3" type="checkbox" id="nav-6-3">
    
    <label class="md-nav__link" for="nav-6-3">
      Gluu LDAP Schema
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-6-3">
        Gluu LDAP Schema
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item">
    
      <a href="../reference/schema/" title="OpenLDAP Schema" class="md-nav__link">
        OpenLDAP Schema
      </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Operation Guide
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-7">
        Operation Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item">
    
      <a href="../operation/backup/" title="Backups" class="md-nav__link">
        Backups
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../operation/find-gluu-server-version/" title="Find your Gluu Version" class="md-nav__link">
        Find your Gluu Version
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../operation/ports/" title="Ports" class="md-nav__link">
        Ports
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../operation/logout/" title="Single Logout (SLO)" class="md-nav__link">
        Single Logout (SLO)
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../operation/logs/" title="Log Management" class="md-nav__link">
        Log Management
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../operation/design/" title="Customize Gluu Login Page" class="md-nav__link">
        Customize Gluu Login Page
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../operation/faq/" title="FAQ & Troubleshooting" class="md-nav__link">
        FAQ & Troubleshooting
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../operation/fine-tuning/" title="Tuning LDAP, Tomcat" class="md-nav__link">
        Tuning LDAP, Tomcat
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../operation/update-certificate/" title="Update Certificate" class="md-nav__link">
        Update Certificate
      </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#design" title="Design" class="md-nav__link">
    Design
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#requirements" title="Requirements" class="md-nav__link">
    Requirements
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#timezone-requirements" title="Timezone Requirements" class="md-nav__link">
    Timezone Requirements
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preparing-vms" title="Preparing VMs" class="md-nav__link">
    Preparing VMs
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#preparing-node-1-of-cluster" title="Preparing Node-1 of cluster:" class="md-nav__link">
    Preparing Node-1 of cluster:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#preparing-node-2-of-cluster" title="Preparing Node-2 of cluster:" class="md-nav__link">
    Preparing Node-2 of cluster:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ldap-replication" title="LDAP Replication" class="md-nav__link">
    LDAP Replication
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#file-system-replication" title="File System Replication" class="md-nav__link">
    File System Replication
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#csync2-installation" title="Csync2 installation" class="md-nav__link">
    Csync2 installation
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#csync2-configuration-for-host-1" title="Csync2 configuration for host-1" class="md-nav__link">
    Csync2 configuration for host-1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#csync2-configuration-for-host-2" title="Csync2 configuration for host-2" class="md-nav__link">
    Csync2 configuration for host-2
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#certificate-management" title="Certificate Management" class="md-nav__link">
    Certificate Management
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#optional-actions-in-case-setuppropertieslast-method-of-installation-didnt-work-for-you" title="[Optional] Actions in case setup.properties.last method of installation didn't work for you" class="md-nav__link">
    [Optional] Actions in case setup.properties.last method of installation didn't work for you
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
               
                 <a href="https://github.com/GluuFederation/docs-ce-prod/tree/2.4.4/2.4.4/source/cluster\index.md" title="Edit this page" class="md-icon md-content__edit">edit</a>
               
              
                
                <h1 id="manual-cluster">Manual Cluster<a class="headerlink" href="#manual-cluster" title="Permanent link">#</a></h1>
<h2 id="design">Design<a class="headerlink" href="#design" title="Permanent link">#</a></h2>
<p>The following diagram outlines the design of the cluster.
<img alt="image" src="../../img/cluster/overview.png" /></p>
<h2 id="requirements">Requirements<a class="headerlink" href="#requirements" title="Permanent link">#</a></h2>
<p>For complete deployment requirements and instructions, please see the <a href="../installation-guide/">Deployment Page</a>.
The requirements for Clusters vary only in the RAM requirement. Clusters require at least 8GB RAM for smooth performance. The requirements below are specific for Cluster Installation VMs.</p>
<table>
<thead>
<tr>
<th>Number of VMs</th>
<th>CPU Units</th>
<th>RAM</th>
<th>Root Partion</th>
<th>Port Requirements</th>
</tr>
</thead>
<tbody>
<tr>
<td>2</td>
<td>2 CPU ea.</td>
<td>8 GB</td>
<td>40 GB</td>
<td>4444 and 8989 (LDAP replication), 30865 (file system syncing)</td>
</tr>
</tbody>
</table>
<p><strong>NOTE: Above three ports should be opened in such a way that Node-1/host-1 can talk to Node-2/host-2 through these ports and vice versa</strong></p>
<p><strong>Note:</strong> For convenience, the VMs are identified as <code>host-1</code> and <code>host-2</code></p>
<h3 id="timezone-requirements">Timezone Requirements<a class="headerlink" href="#timezone-requirements" title="Permanent link">#</a></h3>
<p>It is mandatory to keep the date and time synced between all the nodes of a cluster. It is recommended to change the timzone from UTC to local timezone where the cluster is situated or use a single timezone if the cluster spans multiple timezones. The timezone requirement is applicable to both the VM and the <code>chroot</code> container.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is recommended to use a single timezone for all the nodes of the cluster in both VM and chroot.</p>
</div>
<p>Gluu strongly recommends using <code>ntpd</code> in the VMs and run the <code>ntp</code> daemon from <code>cronjob</code> to sync time. It is preferable if the cronjob is run every second to ensure smooth performance of the cluster.</p>
<h2 id="preparing-vms">Preparing VMs<a class="headerlink" href="#preparing-vms" title="Permanent link">#</a></h2>
<h3 id="preparing-node-1-of-cluster">Preparing Node-1 of cluster:<a class="headerlink" href="#preparing-node-1-of-cluster" title="Permanent link">#</a></h3>
<ul>
<li>Install Gluu CE following the <a href="../installation-guide/">Deployment Page</a> in <code>host-1</code>. <ul>
<li><strong>NOTE: you must provide hostname of the cluster itself to <code>setup.py</code> script (<code>idp.gluu.org</code> in this example), not hostnames of individual nodes!</strong></li>
</ul>
</li>
</ul>
<h3 id="preparing-node-2-of-cluster">Preparing Node-2 of cluster:<a class="headerlink" href="#preparing-node-2-of-cluster" title="Permanent link">#</a></h3>
<ul>
<li>Grab <code>setup.properties.last</code> from Node-1/host-1 ( location: /install/community-edition-setup/ )</li>
<li>Change attribute 'ip': Provide node-2/host-2 IP address here. </li>
<li>Rename <code>setup.properties.last</code> to  <code>setup.properties</code></li>
<li>Put this new file inside 2nd node's Gluu Server container ( location: /install/community-edition/setup/ )</li>
<li>Enter into Gluu Server Container</li>
<li>Run <code>setup.py</code> <ul>
<li><strong>NOTE: As it won't be running in interactive mode this way, make sure you'll provide all optional components (like Shibboleth, Asimba etc) you need to be installed explicitly with keys (run <code># ./setup.py -h</code> for full list of them) Please be sure to read <a href="./#optional-actions-in-case-setuppropertieslast-method-of-installation-didnt-work-for-you">this part</a> in case you failed to setup the 2nd node using <code>setup.properties.last</code> file from the 1st one for some reason, and resorted to installing it from scratch, that will call for additional steps.</strong></li>
</ul>
</li>
</ul>
<h2 id="ldap-replication">LDAP Replication<a class="headerlink" href="#ldap-replication" title="Permanent link">#</a></h2>
<p><strong>NOTE: Deployer need to perform LDAP Replication in Node-1/host-1 as user 'ldap'</strong></p>
<ul>
<li>Things to know</li>
</ul>
<table>
<thead>
<tr>
<th>host-1</th>
<th>host-2</th>
</tr>
</thead>
<tbody>
<tr>
<td>IP Address eg. 192.168.6.1</td>
<td>Ip Address eg. 192.168.6.2</td>
</tr>
<tr>
<td>LDAP admin pass</td>
<td>LDAP admin pass</td>
</tr>
<tr>
<td>ldapGeneralConfigInstall.py</td>
<td></td>
</tr>
<tr>
<td>replicationSetup.py</td>
<td></td>
</tr>
</tbody>
</table>
<ul>
<li>
<p>Log into <code>host-1</code> Gluu Server container</p>
</li>
<li>
<p>Run <a href="../ldapGeneralConfigInstall.py">ldapGeneralConfigInstall.py</a> in <code>host-1</code>. This script will prepare the <code>host-1</code> LDAP server to accept various configurations such as <code>allow-pre-encoded-passwords</code> or applyting the host and port for LDAP Server.</p>
</li>
<li>
<p>Run <a href="../replicationSetup.py">replicationSetup.py</a> in <code>host-1</code> and it will give a similar output as below:</p>
</li>
</ul>
<pre><code>[ldap@]$ python replicationSetup.py 
Create a password for the replication admin: 
Enter number of OpenDJ servers: 2
Enter the hostname of server 1: 192.168.6.1
Enter the Directory Manager password for 192.168.6.1: xxxxx
Enter the hostname of server 2: 192.168.6.2
Enter the Directory Manager password for 192.168.6.2: yyyyy

Establishing connections ..... Done.
Checking registration information ..... Done.
Configuring Replication port on server 192.168.6.1:4444 ..... Done.
Configuring Replication port on server 192.168.6.2:4444 ..... Done.
Updating replication configuration for baseDN o=gluu on server 192.168.6.1:4444 ..... Done.
Updating replication configuration for baseDN o=gluu on server 192.168.6.2:4444 ..... Done.
Updating registration configuration on server 192.168.6.1:4444 ..... Done.
Updating registration configuration on server 192.168.6.2:4444 ..... Done.
Updating replication configuration for baseDN cn=schema on server 192.168.6.1:4444 ..... Done.
Updating replication configuration for baseDN cn=schema on server 192.168.6.2:4444 ..... Done.
Initializing registration information on server 192.168.6.2:4444 with the contents of server 192.168.6.1:4444 ..... Done.
Initializing schema on server 192.168.6.2:4444 with the contents of server 192.168.6.1:4444 ..... Done.

Replication has been successfully enabled.  Note that for replication to work you must initialize the contents of the base DNs that are being replicated (use dsreplication initialize to do so).

See /tmp/opendj-replication-8140652343601372868.log for a detailed log of this
operation.

Enabling Replication Complete.
[ldap@...]$
</code></pre>

<ul>
<li>Initialize directory server replication with this command <code>/opt/opendj/bin/dsreplication initialize</code> and it will give the following output (some issues were reported for this step, resulting in "Invalid credentials" errors; in that case try to run the tool in console mode rather than interactive: <code>/opt/opendj/bin/dsreplication initialize-all --hostname 127.0.0.1 --port 4444 -I 'admin' \
-w 'REPLICATION_ADMIN_PASSWORD' -b 'o=gluu' --trustAll --no-prompt</code>):</li>
</ul>
<pre><code>[ldap@...]$ /opt/opendj/bin/dsreplication initialize


&gt;&gt;&gt;&gt; Specify server administration connection parameters for the source server

Directory server hostname or IP address [idp.gluu.org]: 192.168.6.1

Directory server administration port number [4444]: 

How do you want to trust the server certificate?

    1)  Automatically trust
    2)  Use a truststore
    3)  Manually validate

Enter choice [3]: 1

Global Administrator User ID [admin]: 

Password for user 'admin': #!0^GluU(sWoWSm)


&gt;&gt;&gt;&gt; Specify server administration connection parameters for the destination
server

Directory server hostname or IP address [idp.gluu.org]: 192.168.6.2

Directory server administration port number [4444]: 

How do you want to trust the server certificate?

    1)  Automatically trust
    2)  Use a truststore
    3)  Manually validate

Enter choice [3]: 1

You must choose at least one base DN to be initialized.
Initialize base DN o=gluu? (yes / no) [yes]: 


Initializing the contents of a base DN removes all the existing contents of
that base DN.  Do you want to remove the contents of the selected base DNs on
server 192.168.6.2:4444 and replace them with the contents of server
192.168.6.1:4444? (yes / no) [yes]: 


Initializing base DN o=gluu with the contents from 192.168.6.1:4444:
0 entries processed (0 % complete).
36336 entries processed (99 % complete).
Base DN initialized successfully.

See /tmp/opendj-replication-808135637744675184.log for a detailed log of this
operation.
</code></pre>

<p><sub><em><code>(!)</code> OpenDJ may become picky about certificates used for SSL connections 
during replication in certain linux distros. Make sure you've added certificates of 
each OpenDJ instance to default java key storage of each node; another option is to 
use the same OpenDJ certificate/key pair for both nodes</em></sub>   </p>
<h2 id="file-system-replication">File System Replication<a class="headerlink" href="#file-system-replication" title="Permanent link">#</a></h2>
<p><sub><em><code>(!)</code> Be advised that backup feature is broken in some of earlier versions of csync2 you may get installed from your distribution's repo. In that case you will need either to disable it by commenting out <code>backup-*</code> clauses in tool's configuration file, or to build csync2 of version 2.0+ from sources and use key <code>-l</code> in your xinetd.d's config (like <code>server_args     = -i -l -N idp1.gluu.org</code>) on both nodes.</em></sub> <br />
<sub><em><code>(!)</code> Be sure to verify all pathes (for executables, keys etc) in configuration files' examples before using them in your production instance, as they may differ for different linux distros.</em></sub></p>
<p><code>csync2</code> is used for file system syncing between <code>host-1</code> and <code>host-2</code>. The following locations are synced in between the two VMs.</p>
<ol>
<li>/opt/idp/conf</li>
<li>/opt/idp/metadata</li>
<li>/opt/idp/ssl</li>
<li>/opt/tomcat/conf</li>
<li>/etc/csync2/csync2.cfg</li>
</ol>
<h3 id="csync2-installation">Csync2 installation<a class="headerlink" href="#csync2-installation" title="Permanent link">#</a></h3>
<p>Please follow steps provided in next articles to install csync2 on 
both nodes: <a href="csync-installation/#centos-6x">CentOS 6.x</a>, <a href="csync-installation/#centos-7x">CentOS 7.x</a>, 
<a href="csync-installation/#ubuntu-14x-from-repo">Ubuntu 14.x (from repo)</a>, 
<a href="csync-installation/#ubuntu-14x-compiling-from-sources">Ubuntu 14.x (compiling from sources)</a>.</p>
<h4 id="csync2-configuration-for-host-1">Csync2 configuration for host-1<a class="headerlink" href="#csync2-configuration-for-host-1" title="Permanent link">#</a></h4>
<ol>
<li>
<p>Log into Gluu-Server container</p>
</li>
<li>
<p>Generate <code>csync2</code> private key by running <code>csync2 -k csync2.key</code> and put it into <code>/etc/csync2/csync2.key</code> file</p>
</li>
<li>
<p>Copy the private key to <code>host-2</code> and put it into the same file there</p>
</li>
<li>
<p>Generate certificate/key pair that will be used to establish SSL protection layer for incoming connections by running next commands on <code>host-1</code> (location of the files and their names are hardcoded into executable). Don't fill any fields, just hit <code>Enter</code> accepting default values:</p>
</li>
</ol>
<pre><code>openssl genrsa -out /etc/csync2_ssl_key.pem 1024
openssl req -new -key /etc/csync2_ssl_key.pem -out /etc/csync2_ssl_cert.csr
openssl x509 -req -days 600 -in /etc/csync2_ssl_cert.csr -signkey /etc/csync2_ssl_key.pem \
-out /etc/csync2_ssl_cert.pem
</code></pre>

<p>In case you've compiled csync from sources you may opt to just run <code># make cert</code> 
while in the sources' directory, it will do everything for you.</p>
<ol start ="5">
<li> Add IP and hostnames in the <code>hosts</code> file. In the hosts file example below <code>host-1</code> is called <code>idp1.gluu.org</code> and <code>host-2</code> is called <code>idp2.gluu.org</code></li>
</ol>

<pre><code>127.0.0.1       localhost
::1             ip6-localhost ip6-loopback
ff02::1         ip6-allnodes
ff02::2         ip6-allrouters
192.168.6.1     idp.gluu.org idp1.gluu.org
192.168.6.2     idp2.gluu.org  
</code></pre>

<ol start ="6">
<li> Modify <code>csync2</code> in the <code>/etc/xinetd.d/</code> folder (some packages may reqire you to install it first; run <code># yum install xinetd</code>, then <code># chkconfig xinetd on</code>):</li>
</ol>

<pre><code># default: off
# description: csync2
service csync2
{
        flags           = REUSE
        socket_type     = stream
        wait            = no
        user            = root
        group           = root
        server          = /usr/sbin/csync2
        server_args     = -i -N idp1.gluu.org
        port            = 30865
        type            = UNLISTED
        #log_on_failure += USERID
        disable         = no
        # only_from     = 192.168.199.3 192.168.199.4
}
</code></pre>

<ol start ="7">
<li> Run the following commands</li>
</ol>

<pre><code>service xinetd restart
chkconfig xinetd on
</code></pre>

<p><strong>Note:</strong> The status can be checked by running <code>chkconfig xinetd â€“list</code> and <code>iptables -L -nv | grep 30865</code>. For confirmation, telnet 30865 port from the VMs.</p>
<ol start="8">
<li> Configure <code>csync2.cfg</code> to reflect the configuration below (Please note that csync2 doesn't allow to use symlinks in this file; you'll may need to correct full paths to certain directories as they may change in future Gluu's CE packages)</li>
</ol>

<pre><code>#nossl * *;
group cluster_group
{

        host idp1.gluu.org;
        host idp2.gluu.org;

        key /etc/csync2/csync2.key;
        include /etc/csync2/csync2.cfg;
        include /opt/idp/conf;
        include /opt/idp/metadata;
        include /opt/idp/ssl;
        include /opt/apache-tomcat-7.0.65/conf;

        exclude *~ .*;


        action
        {

                logfile &quot;/var/log/csync2_action.log&quot;;
                do-local;
        }

        action
        {
                pattern /opt/apache-tomcat-7.0.65/conf/*;

                exec &quot;/sbin/service tomcat restart&quot;;
                logfile &quot;/var/log/csync2_action.log&quot;;
                do-local;
        }

        backup-directory /var/backups/csync2;
        backup-generations 3;

        auto younger;
} 
</code></pre>

<ol start ="9">
<li> Start <code>csync2</code> by running <code>csync2 -cvvv -N idp2.gluu.org</code></li>
</ol>

<ol start ="10"> 
<li>Run <code>mkdir -p /var/backups/csync2</code></li>
</ol>

<ol start ="11">
<li> Add cronjob to automate csync2 run. The cronjob example is given below:</li>
</ol>

<pre><code>1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31,33,35,37,39,41,43,45,47,49,51,53,55,57,59 * * * *    /usr/sbin/csync2 -N idp1.gluu.org -xv 2&gt;/var/log/csync2.log 
</code></pre>

<h4 id="csync2-configuration-for-host-2">Csync2 configuration for host-2<a class="headerlink" href="#csync2-configuration-for-host-2" title="Permanent link">#</a></h4>
<ol>
<li>
<p>Log into Gluu-Server container</p>
</li>
<li>
<p>(If you haven't done it yet) Copy the private key you generated on <code>host-1</code> previously to <code>host-2</code> and put it into <code>/etc/csync2/csync2.key</code> file </p>
</li>
<li>
<p>Generate certificate/key pair that will be used to establish SSL protection layer for incoming connections by running next commands on <code>host-2</code> (location of the files and their names are hardcoded into executable). Don't fill any fields, just hit "Enter" accepting default values:</p>
</li>
</ol>
<pre><code>openssl genrsa -out /etc/csync2_ssl_key.pem 1024
openssl req -new -key /etc/csync2_ssl_key.pem -out /etc/csync2_ssl_cert.csr
openssl x509 -req -days 600 -in /etc/csync2_ssl_cert.csr -signkey /etc/csync2_ssl_key.pem \
-out /etc/csync2_ssl_cert.pem
</code></pre>

<p>In case you've compiled csync from sources you may opt to just run <code># make cert</code> while in the sources' directory, it will do everything for you.</p>
<ol start ="4">
<li>Add IP and hostnames in the <code>hosts</code> file. In the hosts file example below <code>host-1</code> is called <code>idp1.gluu.org</code> and <code>host-2</code> is called <code>idp2.gluu.org</code></li>
</ol>

<pre><code>127.0.0.1       localhost
::1             ip6-localhost ip6-loopback
ff02::1         ip6-allnodes
ff02::2         ip6-allrouters
192.168.6.1     idp1.gluu.org
192.168.6.2     idp.gluu.org idp2.gluu.org
</code></pre>

<ol start ="5">
<li> Modify <code>csync2</code> in the <code>/etc/xinetd.d/</code> folder (some packages may reqire you to install it first; run <code># yum install xinetd</code>, then <code># chkconfig xinetd on</code>):</li>
</ol>

<pre><code># default: off
# description: csync2
service csync2
{
        flags           = REUSE
        socket_type     = stream
        wait            = no
        user            = root
        group           = root
        server          = /usr/sbin/csync2
        server_args     = -i -N idp2.gluu.org
        port            = 30865
        type            = UNLISTED
        #log_on_failure += USERID
        disable         = no
        # only_from     = 192.168.199.3 192.168.199.4
}
</code></pre>

<ol start ="6">
<li> Run the following commands</li>
</ol>

<pre><code>service xinetd restart
chkconfig xinetd on
</code></pre>

<p><strong>Note:</strong> The status can be checked by running <code>chkconfig xinetd â€“list</code> and <code>iptables -L -nv | grep 30865</code>. For confirmation, telnet 30865 port from the VMs.</p>
<ol start ="7">
<li> Configure <code>csync2.cfg</code> to reflect the configuration below (Please note that csync2 doesn't allow to use symlinks in this file; you'll may need to correct full paths to certain directories as they may change in future Gluu's CE packages):</li>
</ol>

<pre><code>#nossl * *;
group cluster_group
{

        host idp1.gluu.org;
        host idp2.gluu.org;

        key /etc/csync2/csync2.key;
        include /etc/csync2/csync2.cfg;
        include /opt/idp/conf;
        include /opt/idp/metadata;
        include /opt/idp/ssl;
        include /opt/apache-tomcat-7.0.65/conf;

        exclude *~ .*;


        action
        {

                logfile &quot;/var/log/csync2_action.log&quot;;
                do-local;
        }

        action
        {
                pattern /opt/apache-tomcat-7.0.65/conf/*;

                exec &quot;/sbin/service tomcat restart&quot;;
                logfile &quot;/var/log/csync2_action.log&quot;;
                do-local;
        }

        backup-directory /var/backups/csync2;
        backup-generations 3;

        auto younger;
} 
</code></pre>

<ol start ="8">
<li> Start <code>csync2</code> by running <code>csync2 -cvvv -N idp2.gluu.org</code></li>
</ol>

<ol start ="9"><li> Run <code>mkdir -p /var/backups/csync2</code></li></ol>

<ol start ="10">
<li> Add cronjob to automate csync2 run. The cronjob example is given below:</li></ol>

<pre><code>1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31,33,35,37,39,41,43,45,47,49,51,53,55,57,59 * * * *    /usr/sbin/csync2 -N idp2.gluu.org -xv 2&gt;/var/log/csync2.log 
</code></pre>

<h2 id="certificate-management">Certificate Management<a class="headerlink" href="#certificate-management" title="Permanent link">#</a></h2>
<p>Certificates are not being synced automatically in the proposed setup. They must be initially copied by hand from one node to the other, and must be synced in this manner each time they are being updated.
in each host, when required. Move to <code>/etc/certs/</code> on the 1st node (inside the container). Copy all keys, certs and key storages conforming to these masks: <code>httpd.*</code>, <code>asimba.*</code>, <code>asimbaIDP.*</code>, <code>idp-encryption.*</code>, <code>idp-signing.*</code>, <code>shibIDP.*</code>, <code>oxauth-keys.*</code> and <code>scim-rs.*</code> - to the same directory on the 2nd node (overwriting files that exist there; you may opt to backup them first, just in case).</p>
<p>After that's done you still will need to update default system storage (<code>cacerts</code> file) at the 2nd node with these newly copied certificates. The <a href="../admin-guide/certificates/">Certificate Page</a> contains the details about available certificates and how to update certificates are detailed in the <a href="../operation/update-certificate/">update-certificate page</a>.</p>
<h3 id="optional-actions-in-case-setuppropertieslast-method-of-installation-didnt-work-for-you">[Optional] Actions in case setup.properties.last method of installation didn't work for you<a class="headerlink" href="#optional-actions-in-case-setuppropertieslast-method-of-installation-didnt-work-for-you" title="Permanent link">#</a></h3>
<p>In this case jks keystores you'll be moving to the 2nd node will be protected by passwords hardcoded into different configuration files on the 1st node, which are different from the similar passwords hardcoded into the same files on the 2nd node.</p>
<p>Thus you MUST ensure that the 1st node will be the one that will initialize the 2nd node during first csync's run (i.e., that it will win any conflicts due to changes in files that csync may detect during its very first run), as otherwise different components won't be able to decrypt these keystores and will fail.</p>
<p>To achieve this you should run initial sync manualy after completing configuring it, but before you install cron jobs:</p>
<ol>
<li>
<p>Comment out <code>auto younger;</code> string in <code>csync2.cfg</code> on both nodes to disable autoresolution of conflicts</p>
</li>
<li>
<p>Run <code># csync2 -crvvv -N idp1.gluu.org /</code> on the 1st node</p>
</li>
<li>
<p>Run <code># csync2 -crvvv -N idp2.gluu.org /</code> on the 2nd node</p>
</li>
<li>
<p>Previous commands did initial scan and filled metadata database. Now run <code># csync2 -xrvvv -N idp1.gluu.org /</code> on the 1st node. That will try to sync files with the 2nd node, and most likely will fail to replicate all files due to some conflicts.</p>
</li>
<li>
<p>You should be now in a state of conflict, as certain files in directories to be synced differ between nodes and tool can't decide which to prefer. Run this <code># csync2 -frvvv -N idp1.gluu.org /</code> on the 1st node to mark its files that are still in dirty state as the ones that will win any conflict next time.</p>
</li>
<li>
<p>Run <code># csync2 -xrvvv -N idp1.gluu.org /</code> on the 1st node to complete your initial sync. Now all your 2nd node's directories covered by csync should be identical to the 1st node's.</p>
</li>
<li>
<p>Uncomment <code>auto younger;</code> string and proceed to installing cron jobs</p>
</li>
</ol>
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="csync-installation/" title="Requirements: csync2 Installation" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Requirements: csync2 Installation
              </span>
            </div>
          </a>
        
        
          <a href="../admin-guide/oxtrust-ui/" title="oxTrust admin UI" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                oxTrust admin UI
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2017, Gluu, Inc.
          </div>
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application-2afe21e0b2.js"></script>
      <script>var config={url:{base:".."}},app=new Application(config);app.initialize()</script>
      
    
    
      
    
  </body>
</html>